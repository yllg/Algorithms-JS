<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        // 方法一：分组循环
        // 时间复杂度：O(n)
        // 空间复杂度：O(1)
        var maxSumTrionic = function (nums) {
            const n = nums.length;
            let ans = -Infinity;

            for (let i = 0; i < n; i++) {
                let j = i + 1;
                let res = 0;

                // 第一段: 上升段
                while (j < n && nums[j - 1] < nums[j]) {
                    j++;
                }
                const p = j - 1;

                if (p === i) {
                    continue;
                }

                // 第二段: 下降段
                res += nums[p] + nums[p - 1];
                while (j < n && nums[j - 1] > nums[j]) {
                    res += nums[j];
                    j++;
                }
                const q = j - 1;

                if (q === p || q === n - 1 || (j < n && nums[j] <= nums[q])) {
                    i = q;
                    continue;
                }

                // 第三段: 上升段
                res += nums[q + 1];

                // 第三段求累加最大值
                let maxSum = 0;
                let sum = 0;
                for (let k = q + 2; k < n && nums[k] > nums[k - 1]; k++) {
                    sum += nums[k];
                    maxSum = Math.max(maxSum, sum);
                }
                res += maxSum;

                // 第一段求累加最大值
                maxSum = 0;
                sum = 0;
                for (let k = p - 2; k >= i; k--) {
                    sum += nums[k];
                    maxSum = Math.max(maxSum, sum);
                }
                res += maxSum;

                // 更新答案
                ans = Math.max(ans, res);
                i = q - 1;
            }

            return ans;
        };


    </script>
</body>

</html>