<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 方法一：枚举 + 计数
      // 时间复杂度：O(n)
      // 空间复杂度：O(n)
      var MOD = 1e9 + 7;

      var specialTriplets = function (nums) {
        const numCnt = new Map();
        const numPartialCnt = new Map();

        for (const v of nums) {
          numCnt.set(v, (numCnt.get(v) ?? 0) + 1);
        }

        let ans = 0;
        for (const v of nums) {
          const target = v * 2;
          const lCnt = numPartialCnt.get(target) ?? 0;

          numPartialCnt.set(v, (numPartialCnt.get(v) ?? 0) + 1);
          const rCnt =
            (numCnt.get(target) ?? 0) - (numPartialCnt.get(target) ?? 0);

          ans += (lCnt * rCnt) % MOD;
          ans %= MOD;
        }
        return ans;
      };

      // 方法二：枚举 + 二分查找
      // 时间复杂度：O(nlogn)
      // 空间复杂度：O(n)
      var MOD = 1e9 + 7;

      var specialTriplets = function (nums) {
        const pos = new Map();

        for (let i = 0; i < nums.length; i++) {
          const v = nums[i];
          if (pos.has(v)) {
            pos.get(v).push(i);
          } else {
            pos.set(v, [i]);
          }
        }

        const upperBound = (arr, i) => {
          let l = 0,
            r = arr.length - 1;

          while (l < r) {
            const mid = l + ((r - l + 1) >> 1);
            if (i >= arr[mid]) {
              l = mid;
            } else {
              r = mid - 1;
            }
          }
          return [l + 1, arr.length - 1 - l];
        };

        let ans = 0;
        for (let i = 1; i < nums.length - 1; i++) {
          const targetPos = pos.get(nums[i] * 2);
          if (targetPos && targetPos.length > 1 && targetPos[0] < i) {
            let [l, r] = upperBound(targetPos, i);
            if (nums[i] === 0) {
              l--;
            }
            ans += (l * r) % MOD;
            ans %= MOD;
          }
        }
        return ans;
      };

      // test
      let nums = [8, 4, 2, 8, 4];
      console.log(specialTriplets(nums));
    </script>
  </body>
</html>
