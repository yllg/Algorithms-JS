<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 方法一：枚举两侧的字符
      var countPalindromicSubsequence = function (s) {
        const n = s.length;
        let res = 0;
        // 枚举两侧字符
        for (let ch = "a".charCodeAt(0); ch <= "z".charCodeAt(0); ch++) {
          const c = String.fromCharCode(ch);
          let l = 0,
            r = n - 1;
          // 寻找该字符第一次出现的下标
          while (l < n && s[l] !== c) {
            ++l;
          }
          // 寻找该字符最后一次出现的下标
          while (r >= 0 && s[r] !== c) {
            --r;
          }
          if (r - l < 2) {
            // 该字符未出现，或两下标中间的子串不存在
            continue;
          }
          // 利用哈希集合统计 s[l+1..r-1] 子串的字符总数，并更新答案
          const charset = new Set();
          for (let k = l + 1; k < r; k++) {
            charset.add(s[k]);
          }
          res += charset.size;
        }
        return res;
      };

      // 方法二：枚举中间的字符
      // 时间复杂度：O(n+∣Σ∣)
      // 空间复杂度：O(∣Σ∣)
      var countPalindromicSubsequence = function (s) {
        const n = s.length;
        let res = 0;
        // 前缀/后缀字符状态数组
        const pre = new Array(n).fill(0);
        const suf = new Array(n).fill(0);
        for (let i = 0; i < n; ++i) {
          // 前缀 s[0..i-1] 包含的字符种类
          pre[i] = (i > 0 ? pre[i - 1] : 0) | (1 << (s.charCodeAt(i) - 97));
        }
        for (let i = n - 1; i >= 0; --i) {
          // 后缀 s[i+1..n-1] 包含的字符种类
          suf[i] =
            (i !== n - 1 ? suf[i + 1] : 0) | (1 << (s.charCodeAt(i) - 97));
        }
        // 每种中间字符的回文子序列状态数组
        const ans = new Array(26).fill(0);
        for (let i = 1; i < n - 1; ++i) {
          ans[s.charCodeAt(i) - 97] |= pre[i - 1] & suf[i + 1];
        }
        // 更新答案
        for (let i = 0; i < 26; ++i) {
          res += ans[i].toString(2).split("1").length - 1;
        }
        return res;
      };

      // test
      let s = "aabca";
      console.log(countPalindromicSubsequence(s));
    </script>
  </body>
</html>
