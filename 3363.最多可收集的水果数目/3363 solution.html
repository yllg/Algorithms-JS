<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // 方法一：动态规划
      // 时间复杂度：O(n^2)
      // 空间复杂度：O(n)
      var maxCollectedFruits = function (fruits) {
        const n = fruits.length;
        let ans = 0;
        for (let i = 0; i < n; ++i) ans += fruits[i][i];

        function dp() {
          let prev = Array(n).fill(-Infinity);
          let curr = Array(n).fill(-Infinity);
          prev[n - 1] = fruits[0][n - 1];

          for (let i = 1; i < n - 1; ++i) {
            for (let j = Math.max(n - 1 - i, i + 1); j < n; ++j) {
              let best = prev[j];
              if (j - 1 >= 0) {
                best = Math.max(best, prev[j - 1]);
              }
              if (j + 1 < n) {
                best = Math.max(best, prev[j + 1]);
              }
              curr[j] = best + fruits[i][j];
            }
            [prev, curr] = [curr, prev];
          }
          return prev[n - 1];
        }

        ans += dp();
        for (let i = 0; i < n; ++i) {
          for (let j = 0; j < i; ++j) {
            [fruits[i][j], fruits[j][i]] = [fruits[j][i], fruits[i][j]];
          }
        }

        ans += dp();
        return ans;
      };

      // test
      let fruits = [
        [1, 2, 3, 4],
        [5, 6, 8, 7],
        [9, 10, 11, 12],
        [13, 14, 15, 16],
      ];
      console.log(maxCollectedFruits(fruits));
    </script>
  </body>
</html>
