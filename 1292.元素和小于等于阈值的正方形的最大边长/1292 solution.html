<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        // 方法一：二分查找
        // 时间复杂度：O(m * n * log(min(m, n)))
        var maxSideLength = function (mat, threshold) {
            const m = mat.length, n = mat[0].length;
            const P = Array.from({ length: m + 1 }, () => new Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    P[i][j] = P[i - 1][j] + P[i][j - 1] - P[i - 1][j - 1] + mat[i - 1][j - 1];
                }
            }

            let l = 1, r = Math.min(m, n), ans = 0;
            while (l <= r) {
                const mid = Math.floor((l + r) / 2);
                let find = false;
                for (let i = 1; i <= m - mid + 1; i++) {
                    for (let j = 1; j <= n - mid + 1; j++) {
                        const sum = P[i + mid - 1][j + mid - 1] - P[i - 1][j + mid - 1] -
                            P[i + mid - 1][j - 1] + P[i - 1][j - 1];
                        if (sum <= threshold) {
                            find = true;
                            break;
                        }
                    }
                    if (find) break;
                }
                if (find) {
                    ans = mid;
                    l = mid + 1;
                } else {
                    r = mid - 1;
                }
            }
            return ans;
        };


        // 方法二：枚举 + 优化
        // 时间复杂度：O(m * n)
        // 空间复杂度：O(m * n)
        var maxSideLength = function (mat, threshold) {
            const m = mat.length, n = mat[0].length;
            const P = Array.from({ length: m + 1 }, () => new Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    P[i][j] = P[i - 1][j] + P[i][j - 1] - P[i - 1][j - 1] + mat[i - 1][j - 1];
                }
            }

            const getRect = (x1, y1, x2, y2) => {
                return P[x2][y2] - P[x1 - 1][y2] - P[x2][y1 - 1] + P[x1 - 1][y1 - 1];
            };

            const r = Math.min(m, n);
            let ans = 0;
            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    for (let c = ans + 1; c <= r; c++) {
                        if (i + c - 1 <= m && j + c - 1 <= n && getRect(i, j, i + c - 1, j + c - 1) <= threshold) {
                            ans = c;
                        } else {
                            break;
                        }
                    }
                }
            }
            return ans;
        };


        // test
        let mat = [[1, 1, 3, 2, 4, 3, 2], [1, 1, 3, 2, 4, 3, 2], [1, 1, 3, 2, 4, 3, 2]], threshold = 4
        console.log(maxSideLength(mat, threshold));
    </script>
</body>

</html>